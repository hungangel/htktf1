<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js">
	var thangnam="";	
</script>
<style>
body {
	color: #566787;
	background: #f5f5f5;
	font-family: 'Varela Round', sans-serif;
	font-size: 13px;
}

.table-responsive {
	margin: 30px 0;
}

.table-wrapper {
	background: #fff;
	padding: 20px 25px;
	border-radius: 3px;
	min-width: 950px;
	box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
}

.table-title {
	padding-bottom: 15px;
	background: #435d7d;
	color: #fff;
	padding: 16px 30px;
	min-width: 90%;
	margin: -20px -25px 10px;
	border-radius: 3px 3px 0 0;
	
}

.table-title h2 {
	margin: 5px 0 0;
	font-size: 24px;
}

.table-title .btn-group {
	float: right;
}

.table-title .btn {
	color: #fff;
	float: right;
	font-size: 13px;
	border: none;
	min-width: 50px;
	border-radius: 2px;
	border: none;
	outline: none !important;
	margin-left: 10px;
}

.table-title .btn i {
	float: left;
	font-size: 21px;
	margin-right: 5px;
}

.table-title .btn span {
	float: left;
	margin-top: 2px;
}

table.table tr th, table.table tr td {
	border-color: #e9e9e9;
	padding: 12px 15px;
	vertical-align: middle;
	width : 120px ;
	margin-right : 60px;
}

table.table tr th:first-child {
	width: 120px;
}

table.table tr th:last-child {
	width: 150px;
}


table.table-striped tbody tr:nth-of-type(odd) {
	background-color: #fcfcfc;
}

table.table-striped.table-hover tbody tr:hover {
	background: #f5f5f5;
}

table.table th i {
	font-size: 13px;
	margin: 0 5px;
	cursor: pointer;
}

table.table td:last-child i {
	opacity: 0.9;
	font-size: 22px;
	margin: 0 5px;
}

table.table td a {
	font-weight: bold;
	color: #566787;
	display: inline-block;
	text-decoration: none;
	outline: none !important;
}

table.table td a:hover {
	color: #2196F3;
}

table.table td a.edit {
	color: #FFC107;
}

table.table td a.delete {
	color: #F44336;
}

table.table td i {
	font-size: 19px;
}

table.table .avatar {
	border-radius: 50%;
	vertical-align: middle;
	margin-right: 10px;
}

.pagination {
	float: right;
	margin: 0 0 5px;
}

.pagination li a {
	border: none;
	font-size: 13px;
	min-width: 30px;
	min-height: 30px;
	color: #999;
	margin: 0 2px;
	line-height: 30px;
	border-radius: 2px !important;
	text-align: center;
	padding: 0 6px;
}

.pagination li a:hover {
	color: #666;
}

.pagination li.active a, .pagination li.active a.page-link {
	background: #03A9F4;
}

.pagination li.active a:hover {
	background: #0397d6;
}

.pagination li.disabled i {
	color: #ccc;
}

.pagination li i {
	font-size: 16px;
	padding-top: 6px
}

.hint-text {
	float: left;
	margin-top: 10px;
	font-size: 13px;
}
/* Custom checkbox */
.custom-checkbox {
	position: relative;
}

.custom-checkbox input[type="checkbox"] {
	opacity: 0;
	position: absolute;
	margin: 5px 0 0 3px;
	z-index: 9;
}

.custom-checkbox label:before {
	width: 18px;
	height: 18px;
}

.custom-checkbox label:before {
	content: '';
	margin-right: 10px;
	display: inline-block;
	vertical-align: text-top;
	background: white;
	border: 1px solid #bbb;
	border-radius: 2px;
	box-sizing: border-box;
	z-index: 2;
}

.custom-checkbox input[type="checkbox"]:checked+label:after {
	content: '';
	position: absolute;
	left: 6px;
	top: 3px;
	width: 6px;
	height: 11px;
	border: solid #000;
	border-width: 0 3px 3px 0;
	transform: inherit;
	z-index: 3;
	transform: rotateZ(45deg);
}

.custom-checkbox input[type="checkbox"]:checked+label:before {
	border-color: #03A9F4;
	background: #03A9F4;
}

.custom-checkbox input[type="checkbox"]:checked+label:after {
	border-color: #fff;
}

.custom-checkbox input[type="checkbox"]:disabled+label:before {
	color: #b8b8b8;
	cursor: auto;
	box-shadow: none;
	background: #ddd;
}
/* Modal styles */
.modal .modal-dialog {
	max-width: 400px;
}

.modal .modal-header, .modal .modal-body, .modal .modal-footer {
	padding: 20px 30px;
}

.modal .modal-content {
	border-radius: 3px;
	font-size: 14px;
}

.modal .modal-footer {
	background: #ecf0f1;
	border-radius: 0 0 3px 3px;
}

.modal .modal-title {
	display: inline-block;
}

.modal .form-control {
	border-radius: 2px;
	box-shadow: none;
	border-color: #dddddd;
}

.modal textarea.form-control {
	resize: vertical;
}

.modal .btn {
	border-radius: 2px;
	min-width: 100px;
}

.modal form label {
	font-weight: normal;
}
.container-xl {
	padding-right : 0px ; 
	padding-left : 0px ;
}
</style>
</head>
<body>
	<div id="div1" class="container-xl">
	<div class="table-responsive">
		<div class="table-wrapper">
			<div class="table-title">
				<div class="row">
					<div class="col-sm-5">
						<h2>
							Kê khai 
						</h2>
						<h2>
							 <b>Hàng hóa, dịch vụ bán ra</b>
						</h2>
					</div>
					<div  class="col-sm-7" style="margin-top:15px"  >
							<div style="float:left ; padding-left:80px" >
			<label>Tháng : </label>
			<input style ="height:35px;text-align:center" type="month" id ="thangnam" name="thangnam">
			 <a style ="height:33px;width:60px;text-align:center;" type="submit" class="btn btn-danger" onclick="kekhaiDonbanra()" >Xem  </a>
		</div>
                            <a style="float:right" class="btn btn-success"  onclick="taoTokhaithue()" >
                            <i class="material-icons">&#xE147;</i> <span>Tạo tờ khai thuế</span></a> 
					</div>
				</div>
		</div>
		</div>
		
		<p id="tonggiatri" align="right" style="color:blue;font-size:20px;margin-right:30px"> <b> Tổng giá trị: 0</b>  </p>
		
		<table id ="listTable" class="table table-striped table-hover">
			<thead>
				<tr>
					<th>Mã hoá đơn</th>
					<th>Ngày lập</th>
					<th>Khách hàng</th>
					<th>Mã số thuế </th>
					<th>Mặt hàng </th>
					<th>Thành tiền </th>
					<th>Thuế suất</th>
				</tr>
			</thead>
			<tbody>
				
			</tbody>
		</table>
		</div>
	</div>
	<div id="div2" style="display:none" >
		<div  class="col-sm-3" >
             <a style="float:right; display: inline" class="btn btn-success"  onclick="luuTokhaithue()"  >
             <i style="float:right; display: inline-block" class="material-icons">&#xE161;</i> <span>Lưu tờ khai thuế</span></a> 
		</div>
		<p></p>
		<table id ="tokhaithue" class="table table-striped table-hover" border="1">
			<thead>
				<tr>
					<th style="width:5%" >STT</th>
					<th style="width:60%; text-align:center ">Chỉ tiêu</th>
					<th style="width:20%">Giá trị HHDV(chưa có thuế)</th>
					<th style="width:15%">Thuế GTGT</th>
				</tr>
				<tr >
					<td> <b>A</b></td> <td> <b>Không phát sinh hoạt động mua,bán trong kỳ ( đánh dấu "X")</b></td> 
					<td> </td> 
					<td> </td>
				</tr>
				<tr >
					<td><b>B</b></td><td> <b>Thuế GTGT còn được khấu trừ từ kì trước chuyển sang</b></td>
					<td> </td>
					<td id="thueNokitruoc"> </td>
				</tr>
				<tr >
					<td><b>C</b></td><td> <b>Kê khai thuế GTGT phải nộp Ngân sách nhà nước</b></td>
					<td> </td>
					<td> </td>
				</tr>
				<tr >
					<td><b>I</b></td><td>  <b>Hàng hóa, dịch vụ (HHDV) mua vào trong kì</b></td>
					<td></td>
					<td> </td>
				</tr>
				<tr >
					<td>1 </td><td>  <b>Giá trị và thuế GTGT của hàng hóa, dịch vụ mua vào</b></td>
					<td id="doanhsoMua"></td>
					<td id="thueMua1"> </td>
				</tr>
				<tr>
					<td>2 </td><td>  <b>Tổng số thuế GTGT được khấu trừ kì này</b></td>
					<td></td>
					<td id= "thueMua2"> </td>
				</tr>
				<tr>
					<td><b>II </b></td>	<td> <b> Hàng hóa, dịch vụ  bán ra trong kì</b></td>
					<td></td>
					<td> </td>
				</tr>
				<tr>
					<td>1 </td><td>  <b>Hàng hóa, dịch vụ bán ra không chịu thuế GTGT</b></td>
					<td>0</td>
					<td> </td>
				</tr>
				<tr>
					<td>2 </td><td> <b> Hàng hóa, dịch vụ chịu thuế GTGT</b> </td>
					<td id ="doanhsoBan1"></td>
					<td id= "thueKinay1"> </td>
				</tr>
				<tr>
					<td>a </td><td>  Hàng hóa, dịch vụ bán ra chịu thuế suất 0 %</td>
					<td>0</td>
					<td></td>
				</tr>
				<tr>
					<td>b </td><td>  Hàng hóa, dịch vụ bán ra chịu thuế suất 5 %</td>
					<td>0</td>
					<td>0</td>
				</tr>
				<tr>
					<td>c </td><td>  Hàng hóa, dịch vụ bán ra chịu thuế suất 10 %</td>
					<td id="doanhsoBan2"></td>
					<td id="thueKinay2"> </td>
				</tr>
				<tr>
					<td>3 </td><td>  <b>Tổng doanh thu và thuế GTGT của HHDV bán ra</b> </td>
					<td id="doanhsoBan3"></td>
					<td id="thueKinay3"> </td>
				</tr>
				<tr>
					<td><b>III</b> </td><td>  <b>Thuế GTGT phát sinh trong kì</b> </td>
					<td></td>
					<td id="thuecantra"> </td>
				</tr>
				
				<tr>
					<td><b>IV</b> </td><td>  <b>Điều chỉnh tăng, giảm thuế GTGT của các kì trước</b> </td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td>1</td><td>  <b>Điều chỉnh tăng thuế GTGT của các kì trước</b> </td>
					<td></td>
					<td>0 </td>
				</tr>
				<tr>
					<td>2 </td><td>  <b>Điều chỉnh giảm thuế GTGT của các kì trước</b></td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td><b>V</b> </td><td>  <b>Tổng số thuế GTGT đã nộp của các doanh thu kinh doanh xây dựng lắp đặt, bán hàng vãng lai ngoại tỉnh </b></td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td><b>VI</b> </td><td> <b> Xác định nghĩa vụ thuế GTGT phải nộp trong kì</b> </td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td>1 </td><td> <b>Thuế GTGT phải nộp của hoạt động sản suất kinh doanh trong kì</b> </td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td>2 </td><td>  <b>Thuế GTGT mua vào của dự án đầu tư </b></td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td>3 </td><td>  <b>Thuế GTGT  còn phải nộp trong kì</b></td>
					<td></td>
					<td> 0</td>
				</tr>
				<tr>
					<td>4 </td><td> <b>Thuế GTGT chưa khấu trừ hết kì này</b> </td>
					<td></td>
					<td id="thueNolai1"> </td>
				</tr>
				<tr>
					<td>4.1 </td><td>  Thuế GTGT đề nghị hoàn </td>
					<td></td>
					<td> </td>
				</tr>
				<tr>
					<td>4.2 </td><td> Thuế GTGT còn được khấu trừ chuyển sang kì sau </td>
					<td></td>
					<td id="thueNolai2"> </td>
				</tr>
				
				
			</thead>
			<tbody>
			
			</tbody>
		</table>
	</div>
	<script type="text/javascript">
		function kekhaiDonbanra() {	
			thangnam = $('#thangnam').val();
			$.ajax({
					type : "POST",
					url : "hoadon/kekhaidonbanra",
					data : {
						thangnam:  $('#thangnam').val() , 
					},
					success : function(result) {
						if (result != null) {
							var dshoadon= new Array();
							dshoadon=result[0];
							var tonggiatri= result[1];
							var tienthue= result[2];
							
							$('#listTable tbody').empty();
							$('#tonggiatri').html("<b> Tổng giá trị:</b> "+tonggiatri);			
							$.each(dshoadon,
									function(i, list) {
								var dshanghoa= new Array();
								dshanghoa= list.chitietHoadons;
								
								var j;
								for (j = 0; j < dshanghoa.length; j++) {
								  var newRow = '<tr>' 
									    + '<td>' + list.maHoadon + '</td>'
									    + '<td>' + list.ngayLap + '</td>'
									    +  '<td>' + list.khachhang.tenKH + '</td>'
									    +  '<td>' + list.khachhang.masoThue + '</td>'
									    +  '<td>' + dshanghoa[j].hanghoa.tenHang+ '</td>'
									    + '<td>' + dshanghoa[j].dongia* dshanghoa[j].soluong + '</td>'
									    + '<td>' + '10%'+ '</td>'
									  	$('#listTable tbody').append(newRow);
								}
							});
							
							console.log("Success: ", result);
						} else {
							var result = "<h3 style='color:red'> No person found </h3>";
							$("#feedback").html(result);
						}
					},
					error : function(e) {
						console.log("ERROR: ", e);
					}
			});
		}
		function taoTokhaithue() {
			thangnam = $('#thangnam').val();
			if(thangnam.length >0){
				if(confirm("Xuất bản xem trước tờ khai thuế cho "+ thangnam +" ?")){
					var x = document.getElementById("div1");
					 x.style.display = "none";
					 var y = document.getElementById("div2");
					 y.style.display = "block";
					
					 $.ajax({
							type : "POST",
							url : "hoadon/xemtruoctokhaithue/"+thangnam,
							data : {
								thangnam:  $('#thangnam').val() , 
							},
							success : function(result) {
								if (result != null) {
									var baocao=result;
									document.getElementById('thueNokitruoc').innerHTML = baocao.thueNokitruoc;
									
									document.getElementById('doanhsoMua').innerHTML = baocao.doanhsoMua;
									
									document.getElementById('thueMua1').innerHTML = baocao.thueMua;
									document.getElementById('thueMua2').innerHTML = baocao.thueMua;
									
									document.getElementById('doanhsoBan1').innerHTML = baocao.doanhsoBan;
									document.getElementById('doanhsoBan2').innerHTML = baocao.doanhsoBan;
									document.getElementById('doanhsoBan3').innerHTML = baocao.doanhsoBan;
									
									document.getElementById('thueKinay1').innerHTML = baocao.thueKinay;
									document.getElementById('thueKinay2').innerHTML = baocao.thueKinay;
									document.getElementById('thueKinay3').innerHTML = baocao.thueKinay;
									
									document.getElementById('thuecantra').innerHTML = baocao.thuecantra;
									
									document.getElementById('thueNolai1').innerHTML = baocao.thueNolai;
									document.getElementById('thueNolai2').innerHTML = baocao.thueNolai;
											
									
									console.log("Success: ", result);
								} else {
									var result = "<h3 style='color:red'> Khong  co bao cao </h3>";
									$("#feedback").html(result);
								}
							},
							error : function(e) {
								console.log("ERROR: ", e);
							}
					});
				}else return false ;
			}else alert("Hãy chọn 1 tháng để tạo tờ khai")
		}
		
		function luuTokhaithue() {
			thangnam = $('#thangnam').val();
			if(thangnam.length >0){
				if(confirm("Lưu lại tờ khai thuế cho "+ thangnam +" ?")){
					var x = document.getElementById("div1");
					 x.style.display = "block";
					 var y = document.getElementById("div2");
					 y.style.display = "none";
					var thueNokitruoc= document.getElementById('thueNokitruoc').innerHTML;
					var doanhsoMua= document.getElementById('doanhsoMua').innerHTML;
					var thueMua=  document.getElementById('thueMua1').innerHTML; 
					var doanhsoBan=  document.getElementById('doanhsoBan1').innerHTML; 
					var thueKinay=   document.getElementById('thueKinay1').innerHTML;
					var thuecantra=   document.getElementById('thuecantra').innerHTML;
					var thueNolai=  document.getElementById('thueNolai1').innerHTML ;
					 $.ajax({
							type : "POST",
							url : "baocaothue/luutokhaithue/"+thangnam,
							data : {
								thangnam:  $('#thangnam').val() , 
								thueNokitruoc: thueNokitruoc, 
								doanhsoMua:  doanhsoMua, 
								thueMua: thueMua, 
								doanhsoBan:  doanhsoBan, 
								thueKinay:   thueKinay, 
								thuecantra:   thuecantra, 
								thueNolai:  thueNolai ,
							},
							success : function(result) {
								if (result != null) {
									alert(result);
									console.log("Success: ", result);
								} else {
									var result = "<h3 style='color:red'> Khong  co bao cao </h3>";
									$("#feedback").html(result);
								}
							},
							error : function(e) {
								
								console.log("ERROR: ", e);
							}
					});
				}else return false ;
			}else alert("Hãy chọn 1 tháng để tạo tờ khai")
		}
	</script>
</body>
</html>